package com.wipro.training.bank.service;

import org.springframework.stereotype.Service;

import com.wipro.training.bank.controller.dao.LoginRequest;
import com.wipro.training.bank.controller.dao.RegisterRequest;
import com.wipro.training.bank.model.Account;
import com.wipro.training.bank.repository.AccountRepository;

/*
Author-Abhinav Kumar
Date-Sep 13, 2024
Time-9:36:10â€¯AM
Project-daily-bank
 */

@Service
public class AccountService {

	private final AccountRepository accountRepository;

	public AccountService(AccountRepository accountRepository) {
		this.accountRepository = accountRepository;
	}
	public Account openAccount(Account account) {
		// Generate a 10-digit unique account number
		account.setAccountNumber(generateAccountNumber());
		return accountRepository.save(account);
	}
/*
 * public Account registerForInternetBanking(String accountNumber, String userId,
			String loginPassword, String confirmLoginPassword,
			String transactionPassword, String confirmTransactionPassword) 
	{
		if (!loginPassword.equals(confirmLoginPassword)) {
			throw new IllegalArgumentException("Login passwords do not match");
		}
		if (!transactionPassword.equals(confirmTransactionPassword)) {
			throw new IllegalArgumentException("Transaction passwords do not match");
		}

		Account account = accountRepository.findByAccountNumber(accountNumber);
		if (account != null) {
			account.setUserId(userId);

			// Encode both the login and transaction passwords
			account.setLoginPassword(EncryptionUtil.encode(loginPassword));
			account.setTransactionPassword(EncryptionUtil.encode(transactionPassword));

			return accountRepository.save(account);
		}
		return null;
	}

 */
	public Account registerInternetBanking(RegisterRequest request) {
		Account account = accountRepository.findByAccountNumber(request.getAccountNumber());
		if (account != null) {
			account.setUserId(request.getUserId());
			account.setLoginPassword(request.getLoginPassword());
			account.setTransactionPassword(request.getTransactionPassword());
			return accountRepository.save(account);
		}
		return null;
	}

	public Account login(LoginRequest loginRequest) {
		return accountRepository.findByUserId(loginRequest.getUserId());
	}

	public Account getAccountDetails(String accountNumber) {
		return accountRepository.findByAccountNumber(accountNumber);
	}

	private String generateAccountNumber() {
		// Logic to generate unique 10-digit account number
		return String.valueOf((long)(Math.random() * 1_000_000_000L + 1_000_000_000L));
	}

}
